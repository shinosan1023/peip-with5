<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>P.E.I.P. æ—©æŠ¼ã—ã‚¯ã‚¤ã‚ºï¼ˆæœ€å¤§5äººãƒ»ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --text:#222;
    --muted:#666;
    --card:#fff;
    --line:#eee;
    --brand:#ff69b4; /* å‚åŠ ãƒœã‚¿ãƒ³ãƒ»ãƒ”ãƒ³ã‚¯ç³» */
    --danger:#dc3545;
    --warn:#ff9800;
    --primary:#007bff;
  }
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans JP",sans-serif;margin:0;background:#f7faf9;color:var(--text)}
  header{background:#fff;border-bottom:1px solid var(--line);padding:10px 12px;display:flex;gap:8px;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:3}
  h1{margin:0;font-size:18px}
  .topright{display:flex;gap:8px;align-items:center}
  .pill{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;border:1px solid #ddd;background:#fff}
  .toggle{display:inline-flex;align-items:center;gap:6px;cursor:pointer}
  .btn{border:none;border-radius:10px;padding:10px 14px;cursor:pointer;color:#fff}
  .btn-brand{background:var(--brand)}
  .btn-primary{background:var(--primary)}
  .btn-warn{background:var(--warn)}
  .btn-danger{background:var(--danger)}
  .btn-outline{background:transparent;color:#000;border:1.5px solid #fff; /* ç™½æŠœãé¢¨ */ }
  main{max-width:980px;margin:12px auto;padding:0 12px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:12px;box-shadow:0 6px 16px rgba(0,0,0,.05);padding:14px;margin:12px 0}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  input,button,textarea{font:inherit}
  input,textarea{border:1px solid #ddd;border-radius:8px;padding:8px}
  .muted{color:var(--muted);font-size:12px}
  .rooms{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;margin-top:8px}
  .room{border:1px solid #eee;border-radius:10px;padding:10px;background:#fff;cursor:pointer}
  .room.sel{outline:2px solid var(--primary)}
  .room .cap{font-weight:700}
  .right{margin-left:auto}
  .hidden{display:none}

  /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¡¨ç¤ºï¼ˆé»’å­—ã®ãƒ©ãƒ™ãƒ«ï¼‰ */
  .tag{display:inline-flex;gap:4px;padding:2px 6px;border-radius:999px;border:1px solid #ddd;background:#fff;color:#000;font-weight:700}

  /* å•é¡Œãƒ»å›ç­” */
  .big{font-size:22px;font-weight:800;text-align:center;margin:6px 0 4px}
  .sub{font-size:14px;text-align:center;color:#555}
  .answer-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;margin-top:10px}
  .ans{
    height:120px;border-radius:50%;display:flex;align-items:center;justify-content:center;
    color:#fff;font-weight:900;font-size:16px;cursor:pointer;user-select:none;border:3px solid #fff;
    box-shadow:0 8px 18px rgba(0,0,0,.12), inset 0 2px 0 rgba(255,255,255,.5);
  }
  .ans.disabled{opacity:.5;pointer-events:none}
  .P{background:#e53935}.E{background:#1e88e5}.I{background:#ffca28;color:#222}.Ph{background:#43a047}

  /* ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚ªãƒ¼ãƒãƒ¬ã‚¤ */
  #overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);color:#fff;z-index:99}
  #ovText{font-size:120px;font-weight:900;text-shadow:0 8px 30px rgba(0,0,0,.6)}
  @keyframes pop{0%{transform:scale(.7)}60%{transform:scale(1.15)}100%{transform:scale(1)}}
  .pop{animation: pop .35s ease-out}

  /* è¦³æˆ¦ãƒãƒ£ãƒƒãƒˆ */
  .chat{max-height:180px;overflow:auto;border:1px solid #eee;border-radius:10px;padding:8px;background:#fff}
  .msg{padding:4px 0;border-bottom:1px dashed #eee}
  .msg small{color:#777}

  /* ã‚¿ã‚¤ãƒãƒ¼ã¨æ®‹æ•°è¡¨ç¤º */
  .timer{font-weight:900;color:#d32f2f}
  .rem{font-weight:800}
</style>
</head>
<body>
<header>
  <h1>P.E.I.P. æ—©æŠ¼ã—ã‚¯ã‚¤ã‚º</h1>
  <div class="topright">
    <label class="toggle pill" title="åŠ¹æœéŸ³ ON/OFF">
      <input type="checkbox" id="soundToggle" checked />
      <span id="soundLabel">éŸ³å£°: ON</span>
    </label>
    <button id="leaveBtn" class="btn btn-outline hidden">é€€å‡ºã™ã‚‹</button>
  </div>
</header>

<main>
  <!-- â‘  åå‰å…¥åŠ› -->
  <section id="step1" class="card">
    <h3 style="margin:0 0 8px">â‘  åå‰ã‚’å…¥åŠ›</h3>
    <div class="row">
      <input id="nameInput" placeholder="åå‰ï¼ˆè¡¨ç¤ºåï¼‰" />
      <label class="row" style="gap:6px"><input type="checkbox" id="hostCheck" />ãƒ›ã‚¹ãƒˆã«ãªã‚‹</label>
      <span class="muted">â€» ãƒ›ã‚¹ãƒˆã¯ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ã‚’æŠ¼ã›ã¾ã™ï¼ˆ1äººæƒ³å®šï¼‰</span>
    </div>
  </section>

  <!-- â‘¡ ãƒ«ãƒ¼ãƒ é¸æŠï¼ˆ1ã€œ15ï¼‰ -->
  <section id="step2" class="card">
    <h3 style="margin:0 0 8px">â‘¡ ãƒ«ãƒ¼ãƒ ã‚’é¸ã¶ï¼ˆæœ€å¤§5äººï¼‰</h3>
    <div id="rooms" class="rooms"></div>
    <div class="row" style="margin-top:8px">
      <button id="joinBtn" class="btn btn-brand">å‚åŠ </button>
      <button id="watchBtn" class="btn btn-primary">è¦³æˆ¦</button>
      <span class="muted">â€» å‚åŠ ã¯å…ˆç€5åã€‚è¦³æˆ¦ã¯ä½•äººã§ã‚‚OK</span>
    </div>
  </section>

  <!-- ãƒ«ãƒ¼ãƒ å†… -->
  <section id="roomCard" class="card hidden">
    <div class="row" style="justify-content:space-between">
      <div class="row" style="gap:8px; flex-wrap:wrap">
        <span>ãƒ«ãƒ¼ãƒ :</span><span id="roomId" class="pill"></span>
        <span class="muted">çŠ¶æ…‹:</span><span id="statePill" class="pill">-</span>
        <span class="muted">å‹Ÿé›†çµ‚äº†ã¾ã§:</span><span id="entryLeft" class="timer">--</span>
        <span class="muted">å•é¡Œæ®‹ã‚Š:</span><span id="remain" class="rem">--</span>
        <span class="muted">ã‚ãªãŸã®é †ä½:</span><span id="myRank" class="pill">âˆ’ä½</span>
      </div>
      <div id="hostTools" class="row hidden">
        <button id="startBtn" class="btn btn-warn">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
      </div>
    </div>

    <div style="margin-top:10px">
      <strong>å‚åŠ è€…ï¼ˆæœ€å¤§5äºº / <span id="capText">ã‚ã¨5å</span>ï¼‰</strong>
      <div id="playersList" class="row" style="margin-top:8px;flex-wrap:wrap"></div>
    </div>
  </section>

  <!-- å•é¡Œè¡¨ç¤º -->
  <section id="qCard" class="card hidden">
    <div id="qIdx" class="muted"></div>
    <div id="qText" class="big">å•é¡Œ</div>
    <div id="resultLine" class="sub"></div>
    <div class="answer-grid" id="answerGrid">
      <div class="ans P"  data-choice="P">ãã‚‚ã¡ï¼ˆPï¼‰</div>
      <div class="ans E"  data-choice="E">ã¾ã‚ã‚Šï¼ˆEï¼‰</div>
      <div class="ans I"  data-choice="I">ã§ãã‚‹ã“ã¨ï¼ˆIï¼‰</div>
      <div class="ans Ph" data-choice="Ph">ã‹ã‚‰ã ï¼†ç—…æ°—ï¼ˆPhï¼‰</div>
    </div>
    <div class="sub">ã“ã®å•é¡Œã®è§£ç­”æ™‚é–“ï¼š<span id="qLeft" class="timer">--</span></div>
  </section>

  <!-- è¦³æˆ¦ãƒãƒ£ãƒƒãƒˆï¼ˆè¦³æˆ¦è€… or å‚åŠ è€…ã©ã¡ã‚‰ã§ã‚‚é–²è¦§å¯ï¼‰ -->
  <section id="chatCard" class="card hidden">
    <h3 style="margin:0 0 8px">ğŸ“£ è¦³æˆ¦ãƒ»å¿œæ´</h3>
    <div class="row" style="gap:8px; align-items:flex-start">
      <div class="chat" id="chatBox" style="flex:1;min-width:260px"></div>
      <div style="min-width:220px">
        <textarea id="chatInput" rows="3" placeholder="å¿œæ´ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›ï¼ˆèª°ã§ã‚‚é€ä¿¡å¯ï¼‰"></textarea>
        <div class="row" style="margin-top:6px">
          <button id="chatSend" class="btn btn-primary">é€ä¿¡</button>
          <button id="cheerBtn" class="btn btn-brand">å¿œæ´</button>
        </div>
        <div class="muted" style="margin-top:6px">â€»ã€Œå¿œæ´ã€ã¯ä½•åº¦ã§ã‚‚é³´ã‚‰ã›ã¾ã™ï¼ˆkansei.mp3ï¼‰</div>
      </div>
    </div>
  </section>

  <!-- çµæœ -->
  <section id="finalCard" class="card hidden">
    <h3 style="margin:0 0 8px">æœ€çµ‚çµæœ</h3>
    <div id="finalLine" class="big"></div>
    <div id="finalTable"></div>
  </section>

  <!-- ä½¿ã„æ–¹ãƒ¡ãƒ¢ -->
  <section class="card">
    <div class="muted">
      ãƒ»URLã«ã‚¢ã‚¯ã‚»ã‚¹ â†’ åå‰å…¥åŠ› â†’ â‘¡ãƒ«ãƒ¼ãƒ ã‚’é¸ã¶ â†’ ã€Œå‚åŠ ã€ã¾ãŸã¯ã€Œè¦³æˆ¦ã€ â†’ ï¼ˆãƒ›ã‚¹ãƒˆãŒã€Œã‚²ãƒ¼ãƒ é–‹å§‹ã€ï¼‰â†’ 40å•ãŒé€£ç¶šã§å‡ºé¡Œã€‚<br>
      ãƒ»å…ˆç€1åã®ã¿æœ‰åŠ¹ã€‚æ­£è§£+2ç‚¹ï¼èª¤ç­”-3ç‚¹ã€‚çµæœã¯2ç§’è¡¨ç¤ºã—ã¦æ¬¡ã¸è‡ªå‹•é€²è¡Œã€‚<br>
      ãƒ»çµ‚äº†æ™‚ã¯ã‚´ãƒ³ã‚°éŸ³ã¨é †ä½ç™ºè¡¨ã€‚<br>
      â€»P.E.I.P.ã¯è–éš·ã‚¯ãƒªã‚¹ãƒˆãƒ•ã‚¡ãƒ¼å¤§å­¦ã®ç¯ ï¨‘è‰¯å‹æ°ãŒä»‹è­·éç¨‹æ•™è‚²ã®è³ªå‘ä¸Šã®ãŸã‚ã«ä½œæˆã—ãŸæ•™æã§ã€è‘—ä½œæ¨©ã¯åŒæ°ã«ã‚ã‚Šã¾ã™ã€‚
    </div>
  </section>
</main>

<!-- ã‚ªãƒ¼ãƒãƒ¬ã‚¤ï¼ˆ3,2,1ï¼‰ -->
<div id="overlay"><div id="ovText" class="pop">3</div></div>

<!-- åŠ¹æœéŸ³ï¼ˆindex.html ã¨åŒã˜å ´æ‰€ã«ç½®ãï¼‰ -->
<audio id="seCountdown" src="countdown.mp3" preload="auto"></audio>
<audio id="seCorrect"   src="se_correct.mp3" preload="auto"></audio>
<audio id="seWrong"     src="se_wrong.mp3"   preload="auto"></audio>
<audio id="seGong"      src="gongu.mp3"      preload="auto"></audio>
<audio id="seCheer"     src="kansei.mp3"     preload="auto"></audio>
<audio id="seWarn"      src="keikoku.mp3"    preload="auto"></audio>

<!-- Firebaseï¼ˆcompatç‰ˆï¼‰ -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
/* =========================
   Firebaseï¼ˆpeip-with5ï¼‰
   ========================= */
const firebaseConfig = {
  apiKey: "AIzaSyAkgy5cwaI-rEfR4L1t7TL2-vrWKGKY9HM",
  authDomain: "peip-with5.firebaseapp.com",
  projectId: "peip-with5",
  storageBucket: "peip-with5.firebasestorage.app",
  messagingSenderId: "609048243686",
  appId: "1:609048243686:web:a38452d1872d4ec28cba27",
  measurementId: "G-YCB8S47ENW"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* =========================
   ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
   ========================= */
const $ = (id)=>document.getElementById(id);
const esc = (s)=>String(s||"").replace(/[&<>"'`=\/]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;','/':'&#x2F;','=':'&#x3D;','`':'&#x60;'}[c]));
const uid = (()=>{ const k="peip5-uid"; let v=localStorage.getItem(k); if(!v){ v="u_"+Math.random().toString(36).slice(2,10); localStorage.setItem(k,v);} return v; })();
function play(id){ if(!soundEnabled) return; const el=$(id); try{ el.currentTime=0; el.play(); }catch(_){} }
function now(){ return Date.now(); }
function ms(v){ return Math.max(0, v|0); }

/* =========================
   å®šæ•°ã¨çŠ¶æ…‹
   ========================= */
const MAX_PLAYERS = 5;
const ENTRY_WINDOW_MS = 60000; // å‹Ÿé›†60ç§’
const ANSWER_WINDOW_MS = 8000; // 1å•8ç§’
const SHOW_RESULT_MS = 2000;   // çµæœ2ç§’
let soundEnabled = true;

let currentRoomId = null;
let isSpectator = false;

let me = {
  id: uid,
  name: "",
  isHost: false,
};

const roomsCol = db.collection("rooms");
function roomRef(id){ return roomsCol.doc(id); }
function playersRef(id){ return roomRef(id).collection("players"); }
function shoutsRef(id){ return roomRef(id).collection("shouts"); }

/* =========================
   å•é¡Œãƒ—ãƒ¼ãƒ«ï¼ˆã“ã“ã‹ã‚‰40å•ãƒ©ãƒ³ãƒ€ãƒ ï¼‰
   ========================= */
const labelMap = { P:"ãã‚‚ã¡", E:"ã¾ã‚ã‚Š", I:"ã§ãã‚‹ã“ã¨", Ph:"ã‹ã‚‰ã ï¼†ç—…æ°—" };
const questionsPool = [
  { text: "å­ã©ã‚‚ã«ä¼šã„ãŸã„ã¨æ€ã£ã¦ã„ã‚‹ã‹ï¼Ÿ", answer: "P" },{ text: "æ´—æ¿¯ç‰©ã«ã—ã‚ã¯ãªã„ã‹ï¼Ÿ", answer: "E" },
  { text: "ãƒˆã‚¤ãƒ¬ã§ç«‹ä½ã‚’ã¨ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ï¼Ÿ", answer: "I" },{ text: "ä¾¿ç§˜ã¯ãªã„ã‹ï¼Ÿ", answer: "Ph" },
  { text: "æœé£Ÿã®é£²ã¿ç‰©ã«ã“ã ã‚ã‚Šã¯ã‚ã‚‹ã‹ï¼Ÿ", answer: "P" },{ text: "ãƒˆã‚¤ãƒ¬ã®æ‰‹ã™ã‚Šã«ãã‚‰ã¤ãã¯ãªã„ã‹ï¼Ÿ", answer: "E" },
  { text: "æ­¯ç£¨ãã¯ä¸€äººã§è¡Œãˆã¦ã„ã‚‹ã‹ï¼Ÿ", answer: "I" },{ text: "ã‚€ã›ã“ã¿ã¯ãªã„ã‹ï¼Ÿ", answer: "Ph" },
  { text: "ãƒ‡ã‚¤ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ¥½ã—ã¿ã«ã—ã¦ã„ã‚‹ã‹ï¼Ÿ", answer: "P" },{ text: "å†·è”µåº«ã«æ¶ˆè²»æœŸé™ãŒéããŸé£Ÿå“ã¯ãªã„ã‹ï¼Ÿ", answer: "E" },
  { text: "æ­©è¡Œå™¨ã‚’ä½¿ãˆã°è‡ªç«‹æ­©è¡Œã¯ã§ãã‚‹ã‹ï¼Ÿ", answer: "I" },{ text: "è¶³ã«ã‚€ãã¿ã¯ãªã„ã‹ï¼Ÿ", answer: "Ph" },
  { text: "å¥½ããªéŸ³æ¥½ï¼ˆæ›²ãƒ»æ­Œæ‰‹ï¼‰ã¯ä½•ã‹ï¼Ÿ", answer: "P" },{ text: "æ´—é¢æ‰€ã®åºŠã¯æ¿¡ã‚Œã¦ã„ãªã„ã‹ï¼Ÿ", answer: "E" },
  { text: "ãƒˆã‚¤ãƒ¬ã®ãƒœã‚¿ãƒ³ã‚’æ“ä½œã™ã‚‹ã“ã¨ã¯ã§ãã‚‹ã‹ï¼Ÿ", answer: "I" },{ text: "è‚Œã¯ä¹¾ç‡¥ã—ã¦ã„ãªã„ã‹ï¼Ÿ", answer: "Ph" },
  { text: "æš®ã‚‰ã—ã§å›°ã£ã¦ã„ã‚‹ã“ã¨ã¯ãªã„ã‹ï¼Ÿ", answer: "P" },{ text: "æ¯è‹¦ã—ã•ã‚„èƒ¸ã®åœ§è¿«æ„Ÿã¯ãªã„ã‹ï¼Ÿ", answer: "Ph" },
  { text: "ç€æ›¿ãˆã¯ä»‹åŠ©ãªã—ã§ã§ãã‚‹ã‹ï¼Ÿ", answer: "I" },{ text: "é£Ÿæ¬²ã‚„æ°´åˆ†æ‘‚å–é‡ã¯ã©ã†ã‹ï¼Ÿ", answer: "Ph" },
  { text: "æ˜”ã—ã¦ã„ãŸä»•äº‹ã¯ä½•ã‹ï¼Ÿ", answer: "P" },{ text: "ä½¿ç”¨ã—ã¦ã„ã‚‹ç¦ç¥‰ç”¨å…·ã¯ä½•ã‹ï¼Ÿ", answer: "E" },
  { text: "é›»è©±ã‚’ã‹ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ï¼Ÿ", answer: "I" },{ text: "è¦–åŠ›ã¯ã©ã®ç¨‹åº¦ã‹ï¼Ÿ", answer: "Ph" },
  { text: "é£Ÿã¹ãŸã„ã‚‚ã®ã¯ã‚ã‚‹ã‹ï¼Ÿ", answer: "P" },{ text: "è‡ªå®…ã§10ãƒŸãƒªä»¥ä¸Šã®æ®µå·®ã¯ãªã„ã‹ï¼Ÿ", answer: "E" },
  { text: "ãŠèŒ¶ã‚’å…¥ã‚Œã¦é£²ã‚€ã“ã¨ã¯ã§ãã‚‹ã‹ï¼Ÿ", answer: "I" },{ text: "å¤œé–“ã®ç¡çœ çŠ¶æ³ã¯ã©ã†ã‹ï¼Ÿ", answer: "Ph" },
  { text: "ç¿’æ…£ã¨ãªã£ã¦ã„ã‚‹ã“ã¨ã¯ä½•ã‹ï¼Ÿ", answer: "P" },{ text: "åˆ©ç”¨ã—ã¦ã„ã‚‹ä»‹è­·ã‚µãƒ¼ãƒ“ã‚¹ã¯ä½•ã‹ï¼Ÿ", answer: "E" },
  { text: "ä½“æ“ã§ä½“ã‚’å‹•ã‹ã›ã¦ã„ã‚‹ã‹ï¼Ÿ", answer: "I" },{ text: "ãµã‚‰ã¤ãã¯ãªã„ã‹ï¼Ÿ", answer: "Ph" },
  { text: "è¶£å‘³ã‚’å†é–‹ã—ãŸã„æ€ã„ã¯ã‚ã‚‹ã‹ï¼Ÿ", answer: "P" },{ text: "å±…å®¤ã®æ¸©åº¦ãƒ»å®¤æ¸©ã¯ï¼Ÿ", answer: "E" },
  { text: "é£Ÿäº‹ã®æº–å‚™ã¯ä¸€äººã§ã§ãã‚‹ã‹ï¼Ÿ", answer: "I" },{ text: "è…°ç—›ãªã©ä½“ã®ç—›ã¿ã¯ãªã„ã‹ï¼Ÿ", answer: "Ph" },
  { text: "èª¿å‘³æ–™ã«ã“ã ã‚ã‚Šã¯ã‚ã‚‹ã‹ï¼Ÿ", answer: "P" },{ text: "è–¬ã®ç®¡ç†ã§æ‰‹ä¼ã£ã¦ã»ã—ã„ã“ã¨ã¯ã‚ã‚‹ã‹ï¼Ÿ", answer: "P" },
  { text: "è–¬ã®ç®¡ç†ã¯ä¸€äººã§è¡Œãˆã¦ã„ã‚‹ã‹ï¼Ÿ", answer: "I" },{ text: "ã¾ã¶ãŸã«ç›®ã‚„ã«ã¯ã¤ã„ã¦ã„ãªã„ã‹ï¼Ÿ", answer: "Ph" },
  { text: "ã©ã®ã‚ˆã†ãªç’°å¢ƒã§å¯ãŸã„æ€ã£ã¦ã„ã‚‹ã‹ï¼Ÿ", answer: "P" },{ text: "ã‚³ãƒ¼ãƒ«ã®ãƒœã‚¿ãƒ³ã¯é³´ã‚‹ã‹ï¼Ÿ", answer: "E" },
  { text: "åº§ä½ã‚’ã¨ã‚‹ã“ã¨ã¯ã§ãã¦ã„ã‚‹ã‹ï¼Ÿ", answer: "I" },{ text: "å·»ãçˆªã¯ãªã„ã‹ï¼Ÿ", answer: "Ph" },
  { text: "ä½•ã‚’ã—ã¦ã„ã‚‹æ™‚ãŒå¹¸ã›ã‚’æ„Ÿã˜ã‚‹æ™‚ã‹ï¼Ÿ", answer: "P" },{ text: "ç¾åœ¨ã€äº¤æµã®ã‚ã‚‹äººã¯èª°ã‹ï¼Ÿ", answer: "E" },
  { text: "è²·ã„ç‰©ãƒªã‚¹ãƒˆã‚’æ›¸ãã“ã¨ã¯ã§ãã‚‹ã‹ï¼Ÿ", answer: "I" },{ text: "å¤œé–“ã«ä¸çœ ã¯ãªã„ã‹ï¼Ÿ", answer: "Ph" },
  { text: "ãŠæ°—ã«å…¥ã‚Šã®æœã¯ã‚ã‚‹ã‹ï¼Ÿ", answer: "P" },{ text: "å±…å®¤ã®æ›æ°—çŠ¶æ³ã¯ï¼Ÿ", answer: "E" }
];

/* =========================
   ç”»é¢è¦ç´ 
   ========================= */
const roomsBox = $("rooms");
const playersList = $("playersList");
const capText = $("capText");
const myRankEl = $("myRank");
const entryLeft = $("entryLeft");
const qLeft = $("qLeft");
const remainEl = $("remain");
const qIdxEl = $("qIdx");
const qTextEl = $("qText");
const resultLine = $("resultLine");
const hostTools = $("hostTools");
const leaveBtn = $("leaveBtn");

/* =========================
   éŸ³å£° ON/OFF
   ========================= */
$("soundToggle").addEventListener("change", ()=>{
  soundEnabled = $("soundToggle").checked;
  $("soundLabel").textContent = soundEnabled ? "éŸ³å£°: ON" : "éŸ³å£°: OFF";
  // <audio> ã® muted ã‚’åŒæœŸ
  ["seCountdown","seCorrect","seWrong","seGong","seCheer","seWarn"].forEach(id=>{
    const el=$(id); el.muted = !soundEnabled;
    if(!soundEnabled){ try{ el.pause(); el.currentTime=0; }catch(_){} }
  });
});

/* =========================
   ãƒ«ãƒ¼ãƒ ä¸€è¦§ï¼ˆ1ã€œ15ï¼‰
   ========================= */
const roomIds = Array.from({length:15}, (_,i)=> `room-${String(i+1).padStart(2,'0')}`);
const roomListeners = new Map(); // players listener

function renderRooms(occMap){
  roomsBox.innerHTML = roomIds.map(id=>{
    const occ = occMap.get(id) ?? 0;
    const left = Math.max(0, MAX_PLAYERS - occ);
    return `<div class="room" data-r="${id}">
      <div><strong>${id}</strong></div>
      <div class="muted">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼: ${occ}/${MAX_PLAYERS}</div>
      <div class="cap">ã‚ã¨ ${left} å</div>
    </div>`;
  }).join("");
  // ã‚¯ãƒªãƒƒã‚¯ã§é¸æŠ
  Array.from(roomsBox.querySelectorAll(".room")).forEach(el=>{
    el.onclick = ()=>{
      Array.from(roomsBox.querySelectorAll(".room")).forEach(x=>x.classList.remove("sel"));
      el.classList.add("sel");
    };
  });
}

async function startRoomListeners(){
  const occMap = new Map();
  renderRooms(occMap); // åˆæœŸè¡¨ç¤º
  for(const id of roomIds){
    const l = playersRef(id).onSnapshot(snap=>{
      occMap.set(id, snap.size);
      renderRooms(occMap);
    });
    roomListeners.set(id, l);
  }
}

/* =========================
   å…¥å®¤ï¼ˆå‚åŠ  / è¦³æˆ¦ï¼‰
   ========================= */
function selectedRoomId(){
  const sel = roomsBox.querySelector(".room.sel");
  return sel ? sel.getAttribute("data-r") : null;
}

$("joinBtn").addEventListener("click", async ()=>{
  const name = $("nameInput").value.trim();
  const isHost = $("hostCheck").checked;
  const rid = selectedRoomId();
  if(!name){
    alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
    play("seWarn");
    return;
  }
  if(!rid){ alert("â‘¡ ãƒ«ãƒ¼ãƒ ã‚’é¸ã‚“ã§ãã ã•ã„"); return; }

  me.name = name; me.isHost = false; // å¾Œã§ç¢ºå®š
  currentRoomId = rid; isSpectator = false;

  // ãƒ«ãƒ¼ãƒ åˆæœŸåŒ–ï¼ˆç„¡ã‘ã‚Œã°ï¼‰
  const rRef = roomRef(rid);
  const rDoc = await rRef.get();
  if(!rDoc.exists){
    await rRef.set({
      state:"entry", // entry â†’ countdown â†’ playing â†’ ended
      createdAt: firebase.firestore.FieldValue.serverTimestamp(),
      entryDeadlineMs: now() + ENTRY_WINDOW_MS,
      deck: [],
      currentIndex: 0,
      qOpenedAtMs: 0,
      qOpenUntilMs: 0,
      buzzedBy: null,
      answerChoice: null,
      lastResult: null,
      resultKey: "",
      finished: false
    });
  }else{
    // entryDeadline ãªã‘ã‚Œã°ã‚»ãƒƒãƒˆï¼ˆåˆå‚åŠ è€…ç”¨ï¼‰
    const d = rDoc.data();
    if(d.state==="entry" && !d.entryDeadlineMs){
      await rRef.update({ entryDeadlineMs: now() + ENTRY_WINDOW_MS });
    }
  }

  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æº€å“¡ãƒã‚§ãƒƒã‚¯
  const pSnap = await playersRef(rid).get();
  if(pSnap.size >= MAX_PLAYERS){
    alert("æº€å“¡ã§ã™ã€‚ä»–ã®ãƒ«ãƒ¼ãƒ ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚");
    return;
  }

  // æ—¢ãƒ›ã‚¹ãƒˆç¢ºèª
  let becomeHost = isHost;
  const hSnap = await playersRef(rid).where("isHost","==",true).limit(1).get();
  if(!hSnap.empty){ becomeHost = false; } // ã™ã§ã«ãƒ›ã‚¹ãƒˆãŒã„ã‚‹

  await playersRef(rid).doc(me.id).set({
    name, isHost: becomeHost, score:0, correct:0, wrong:0, totalTimeMs:0,
    joinedAt: firebase.firestore.FieldValue.serverTimestamp(),
    lastSeen: firebase.firestore.FieldValue.serverTimestamp()
  }, { merge:true });

  me.isHost = becomeHost;
  enterRoomView();
});

$("watchBtn").addEventListener("click", async ()=>{
  const name = $("nameInput").value.trim() || "è¦³å®¢";
  const rid = selectedRoomId();
  if(!rid){ alert("â‘¡ ãƒ«ãƒ¼ãƒ ã‚’é¸ã‚“ã§ãã ã•ã„"); return; }
  me.name = name; me.isHost = false;
  currentRoomId = rid; isSpectator = true;
  enterRoomView();
});

function enterRoomView(){
  $("step1").classList.add("hidden");
  $("step2").classList.add("hidden");
  $("roomCard").classList.remove("hidden");
  $("chatCard").classList.remove("hidden");
  $("roomId").textContent = currentRoomId;
  leaveBtn.classList.remove("hidden");
  hostTools.classList.toggle("hidden", !me.isHost);
  subscribeRoom();
  subscribePlayers();
  subscribeShouts();
  startHeartbeat();
}

/* é€€å‡ºï¼ˆå‚åŠ è€…ã¯è‡ªåˆ†ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‰Šé™¤ï¼‰ */
leaveBtn.addEventListener("click", async ()=>{
  if(currentRoomId && !isSpectator){
    try{ await playersRef(currentRoomId).doc(me.id).delete(); }catch(_){}
  }
  window.location.reload();
});
window.addEventListener("beforeunload", async ()=>{
  if(currentRoomId && !isSpectator){
    try{ await playersRef(currentRoomId).doc(me.id).delete(); }catch(_){}
  }
});

/* =========================
   ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆï¼ˆé€”ä¸­é€€å‡ºã®è‡ªå‹•æ¶ˆå»ã‚’åŠ©ã‘ã‚‹ï¼‰
   ========================= */
let hbTimer=null;
function startHeartbeat(){
  if(isSpectator) return;
  if(hbTimer) clearInterval(hbTimer);
  hbTimer = setInterval(async ()=>{
    try{ await playersRef(currentRoomId).doc(me.id).set({ lastSeen: firebase.firestore.FieldValue.serverTimestamp() },{merge:true}); }catch(_){}
  }, 20000);
}

/* =========================
   ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è³¼èª­ï¼ˆé †ä½ãƒ»ã‚ã¨â—¯åï¼‰
   ========================= */
let playersCache = [];
function tieSort(a,b){
  // â‘ score desc â†’ â‘¡correct desc â†’ â‘¢wrong asc â†’ â‘£totalTimeMs asc â†’ joinedAt asc
  if((b.score||0)!==(a.score||0)) return (b.score||0)-(a.score||0);
  if((b.correct||0)!==(a.correct||0)) return (b.correct||0)-(a.correct||0);
  if((a.wrong||0)!==(b.wrong||0)) return (a.wrong||0)-(b.wrong||0);
  if((a.totalTimeMs||0)!==(b.totalTimeMs||0)) return (a.totalTimeMs||0)-(b.totalTimeMs||0);
  return 0;
}

function subscribePlayers(){
  playersRef(currentRoomId).orderBy("joinedAt","asc").onSnapshot(snap=>{
    const arr=[]; snap.forEach(d=>arr.push({ id:d.id, ...d.data() })); playersCache = arr;
    const left = Math.max(0, MAX_PLAYERS - arr.length);
    capText.textContent = `ã‚ã¨ ${left} å`;
    // ã‚ãªãŸã®é †ä½
    const sorted = [...arr].sort(tieSort);
    const myIndex = sorted.findIndex(p=>p.id===me.id);
    myRankEl.textContent = (myIndex>=0) ? `${myIndex+1}ä½` : (isSpectator ? "è¦³æˆ¦" : "âˆ’ä½");
    // è¡¨ç¤º
    playersList.innerHTML = arr.map(p=>{
      const tags = [
        p.id===me.id ? '<span class="tag">ã‚ãªãŸ</span>' : '',
        p.isHost ? '<span class="tag">ãƒ›ã‚¹ãƒˆ</span>' : ''
      ].join(' ');
      return `<div class="pill" title="æ­£:${p.correct||0}ï¼èª¤:${p.wrong||0}ï¼æ™‚é–“:${Math.round((p.totalTimeMs||0)/1000)}s">
        ${esc(p.name)} ${tags} <strong style="margin-left:6px">${Number(p.score||0)}pt</strong>
      </div>`;
    }).join("");
  });
}

/* =========================
   ãƒ«ãƒ¼ãƒ è³¼èª­ï¼ˆçŠ¶æ…‹ç®¡ç†ï¼‰
   ========================= */
let roomUnsub=null, qTimer=null, entryTimer=null;
let localDeckCount = 0;

function clearTimers(){ if(qTimer){ clearInterval(qTimer); qTimer=null; } if(entryTimer){ clearInterval(entryTimer); entryTimer=null; } }

function subscribeRoom(){
  if(roomUnsub) roomUnsub();
  roomUnsub = roomRef(currentRoomId).onSnapshot(async snap=>{
    if(!snap.exists) return;
    const r = snap.data();
    $("statePill").textContent = r.state||'-';

    // å‹Ÿé›†æ®‹ã‚Š
    if(r.state==="entry"){
      $("qCard").classList.add("hidden");
      $("finalCard").classList.add("hidden");
      $("roomCard").classList.remove("hidden");
      if(!entryTimer){
        entryTimer = setInterval(()=>{
          const left = Math.max(0, (r.entryDeadlineMs||0) - now());
          entryLeft.textContent = (left/1000).toFixed(1)+"s";
        }, 100);
      }
    }else{
      entryLeft.textContent = "--";
      if(entryTimer){ clearInterval(entryTimer); entryTimer=null; }
    }

    // ãƒ‡ãƒƒã‚­æƒ…å ±
    const deck = Array.isArray(r.deck) ? r.deck : [];
    localDeckCount = deck.length||40;
    const idx = r.currentIndex||0;
    const remain = Math.max(0, localDeckCount - idx - (r.state==="playing"||r.state==="countdown"||r.state==="result"?1:0));
    $("remain").textContent = `${remain}å•`;

    // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³â†’ã‚²ãƒ¼ãƒ é–‹å§‹ï¼ˆ3,2,1ï¼‰
    if(r.state==="countdown"){
      showOverlay321();
    }

    // å•é¡Œè¡¨ç¤º
    if(r.state==="playing"){
      $("qCard").classList.remove("hidden");
      $("finalCard").classList.add("hidden");
      const q = deck.length>0 ? questionsPool[ deck[idx] ] : questionsPool[idx];
      $("qIdx").textContent = `å•é¡Œ ${idx+1} / ${localDeckCount}`;
      $("qText").textContent = "ã€Œ" + q.text + "ã€";
      $("resultLine").textContent = "";

      // è§£ç­”æ®‹ã‚Š
      if(qTimer) clearInterval(qTimer);
      qTimer = setInterval(async ()=>{
        const left = Math.max(0, (r.qOpenUntilMs||0) - now());
        $("qLeft").textContent = (left/1000).toFixed(1)+"s";
        if(left<=0){
          clearInterval(qTimer); qTimer=null;
          // ã‚¿ã‚¤ãƒ ã‚¢ãƒƒãƒ— â†’ ãƒ›ã‚¹ãƒˆãŒçµæœã¸
          if(me.isHost){
            const latest = (await roomRef(currentRoomId).get()).data();
            if(latest.state==="playing" && !latest.buzzedBy){
              await roomRef(currentRoomId).update({
                state:"result", lastResult:"timeout", resultKey: String(now()),
              });
            }
          }
        }
      }, 100);
    }

    // çµæœè¡¨ç¤ºâ†’2ç§’å¾Œã«è‡ªå‹•æ¬¡ã¸ï¼ˆãƒ›ã‚¹ãƒˆï¼‰
    if(r.state==="result"){
      $("qCard").classList.remove("hidden");
      const msg = r.lastResult==="correct" ? "â­• æ­£è§£ï¼ +2pt"
                : r.lastResult==="wrong"   ? "âŒ ä¸æ­£è§£ -3pt"
                : "æ™‚é–“åˆ‡ã‚Œâ€¦";
      $("resultLine").textContent = msg;

      // åŠ¹æœéŸ³ï¼ˆé‡è¤‡é˜²æ­¢ï¼‰
      if(r.resultKey && r._playedKey !== r.resultKey){
        if(r.lastResult==="correct") play("seCorrect");
        else if(r.lastResult==="wrong") play("seWrong");
        // _playedKey ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§æŒã¦ãªã„ã®ã§éŸ³ã ã‘åˆ¶å¾¡
      }

      if(me.isHost){
        // æ¬¡ã®å•é¡Œ or çµ‚äº†
        setTimeout(async ()=>{
          const d = (await roomRef(currentRoomId).get()).data();
          if(d.state!=="result") return;
          const next = (d.currentIndex||0) + 1;
          if(next >= (d.deck?.length||localDeckCount)){
            // çµ‚äº†
            await roomRef(currentRoomId).update({ state:"ended", finished:true });
          }else{
            await roomRef(currentRoomId).update({
              state:"playing",
              currentIndex: next,
              buzzedBy:null, answerChoice:null,
              lastResult:null, resultKey:"",
              qOpenedAtMs: now(),
              qOpenUntilMs: now()+ANSWER_WINDOW_MS
            });
          }
        }, SHOW_RESULT_MS);
      }
    }

    // çµ‚äº†
    if(r.state==="ended"){
      $("qCard").classList.add("hidden");
      renderFinal();
    }
  });
}

/* 3,2,1 ã‚ªãƒ¼ãƒãƒ¬ã‚¤è¡¨ç¤º + éŸ³ */
function showOverlay321(){
  const ov = $("overlay"), txt = $("ovText");
  ov.style.display="flex"; let seq=["3","2","1"]; let i=0;
  play("seCountdown");
  txt.textContent = seq[0]; txt.classList.remove("pop"); void txt.offsetWidth; txt.classList.add("pop");
  const t = setInterval(async ()=>{
    i++;
    if(i<seq.length){
      txt.textContent = seq[i]; txt.classList.remove("pop"); void txt.offsetWidth; txt.classList.add("pop");
    }else{
      clearInterval(t); ov.style.display="none";
      // ãƒ›ã‚¹ãƒˆãŒ playing ã¸ï¼ˆqOpenedAtMs/qOpenUntilMs ã‚»ãƒƒãƒˆï¼‰
      if(me.isHost){
        await roomRef(currentRoomId).update({
          state:"playing",
          qOpenedAtMs: now(),
          qOpenUntilMs: now()+ANSWER_WINDOW_MS
        });
      }
    }
  }, 1000);
}

/* =========================
   å‚åŠ è€…ã®å›ç­”ï¼ˆå…ˆç€1åï¼‰
   ========================= */
Array.from(document.querySelectorAll(".ans")).forEach(btn=>{
  btn.addEventListener("click", async ()=>{
    if(isSpectator) return; // è¦³æˆ¦ã¯æŠ¼ã›ãªã„
    const choice = btn.dataset.choice;
    // ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼šå…ˆç€1åã ã‘æ¡ç”¨
    await db.runTransaction(async tx=>{
      const doc = await tx.get(roomRef(currentRoomId));
      if(!doc.exists) return;
      const r = doc.data();
      if(r.state!=="playing") return;
      if((r.qOpenUntilMs||0) < now()) return;
      if(r.buzzedBy) return; // å…ˆç´„ã‚ã‚Š
      // è¨˜éŒ²
      tx.update(roomRef(currentRoomId), { state:"result", buzzedBy: me.id, answerChoice: choice });
    });
    // æ­£èª¤ã¨åŠ ç‚¹ã¯ãƒ›ã‚¹ãƒˆãŒå‡¦ç†
    if(me.isHost){
      const doc = await roomRef(currentRoomId).get();
      const r = doc.data();
      if(r.buzzedBy===me.id || r.buzzedBy){ // å…ˆç€ã‚ã‚Š
        const deck = Array.isArray(r.deck)? r.deck : [];
        const idx  = r.currentIndex||0;
        const q = deck.length>0 ? questionsPool[ deck[idx] ] : questionsPool[idx];
        const ok = (r.answerChoice===q.answer);
        const delta = ok ? +2 : -3;
        const elapsedMs = Math.max(0, now() - (r.qOpenedAtMs||now()));
        const resultKey = String(now()) + (ok?"C":"W");
        await Promise.all([
          playersRef(currentRoomId).doc(r.buzzedBy).set({
            score: firebase.firestore.FieldValue.increment(delta),
            correct: firebase.firestore.FieldValue.increment(ok?1:0),
            wrong: firebase.firestore.FieldValue.increment(ok?0:1),
            totalTimeMs: firebase.firestore.FieldValue.increment(elapsedMs)
          }, { merge:true }),
          roomRef(currentRoomId).update({ lastResult: ok?"correct":"wrong", resultKey })
        ]);
      }
    }
  });
});

/* =========================
   ãƒ›ã‚¹ãƒˆï¼šã‚²ãƒ¼ãƒ é–‹å§‹ï¼ˆãƒ‡ãƒƒã‚­ä½œæˆâ†’countdownï¼‰
   ========================= */
$("startBtn").addEventListener("click", async ()=>{
  if(!me.isHost) return;
  const ref = roomRef(currentRoomId);
  const doc = await ref.get();
  const r = doc.data()||{};
  // 40å•ãƒ©ãƒ³ãƒ€ãƒ ãƒ‡ãƒƒã‚­
  let idxs = [...Array(questionsPool.length).keys()];
  idxs.sort(()=>Math.random()-0.5);
  const deck = idxs.slice(0, Math.min(40, idxs.length));
  await ref.update({
    state:"countdown",
    deck, currentIndex:0,
    buzzedBy:null, answerChoice:null, lastResult:null, resultKey:"",
    qOpenedAtMs:0, qOpenUntilMs:0,
    finished:false
  });
});

/* =========================
   è¦³æˆ¦ãƒãƒ£ãƒƒãƒˆï¼ˆèª°ã§ã‚‚é€ä¿¡å¯ï¼‰
   ========================= */
$("chatSend").addEventListener("click", async ()=>{
  if(!currentRoomId) return;
  const t = $("chatInput").value.trim();
  if(!t) return;
  $("chatInput").value="";
  try{
    await shoutsRef(currentRoomId).add({
      name: me.name || "è¦³å®¢",
      text: t.slice(0,200),
      at: firebase.firestore.FieldValue.serverTimestamp()
    });
  }catch(_){}
});
$("cheerBtn").addEventListener("click", ()=>{ play("seCheer"); });

function subscribeShouts(){
  shoutsRef(currentRoomId).orderBy("at","desc").limit(20).onSnapshot(snap=>{
    const arr=[]; snap.forEach(d=>arr.push(d.data()));
    $("chatBox").innerHTML = arr.map(x=>{
      const ts = x.at?.toDate?.() ? x.at.toDate() : null;
      const pad=(n)=>String(n).padStart(2,'0');
      const time = ts ? `${pad(ts.getMonth()+1)}/${pad(ts.getDate())} ${pad(ts.getHours())}:${pad(ts.getMinutes())}` : "";
      return `<div class="msg"><strong>${esc(x.name||"è¦³å®¢")}</strong>ï¼š${esc(x.text||"")}<br><small>${time}</small></div>`;
    }).join("");
  });
}

/* =========================
   æœ€çµ‚çµæœ
   ========================= */
async function renderFinal(){
  // ã‚´ãƒ³ã‚°éŸ³
  play("seGong");
  $("finalCard").classList.remove("hidden");
  const snap = await playersRef(currentRoomId).get();
  const rows=[]; snap.forEach(d=>rows.push({ id:d.id, ...d.data() }));
  rows.sort(tieSort);
  const meIndex = rows.findIndex(p=>p.id===me.id);
  $("finalLine").textContent = `ã‚ãªãŸã®é †ä½ã¯ ${rows.length}äººä¸­ ${meIndex>=0?meIndex+1:"-"}ä½ã§ã—ãŸã€‚ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚`;
  // è¡¨
  let html = `<table style="width:100%;border-collapse:collapse"><thead><tr>
    <th style="text-align:left;border-bottom:1px solid #eee;padding:6px">é †ä½</th>
    <th style="text-align:left;border-bottom:1px solid #eee;padding:6px">åå‰</th>
    <th style="text-align:right;border-bottom:1px solid #eee;padding:6px">å¾—ç‚¹</th>
    <th style="text-align:right;border-bottom:1px solid #eee;padding:6px">æ­£è§£</th>
    <th style="text-align:right;border-bottom:1px solid #eee;padding:6px">èª¤ç­”</th>
    <th style="text-align:right;border-bottom:1px solid #eee;padding:6px">åˆè¨ˆæ™‚é–“</th>
  </tr></thead><tbody>`;
  rows.forEach((r,i)=>{
    html += `<tr>
      <td style="padding:6px;border-bottom:1px solid #f3f3f3">${i+1}</td>
      <td style="padding:6px;border-bottom:1px solid #f3f3f3">${esc(r.name)}</td>
      <td style="padding:6px;border-bottom:1px solid #f3f3f3;text-align:right">${Number(r.score||0)}</td>
      <td style="padding:6px;border-bottom:1px solid #f3f3f3;text-align:right">${Number(r.correct||0)}</td>
      <td style="padding:6px;border-bottom:1px solid #f3f3f3;text-align:right">${Number(r.wrong||0)}</td>
      <td style="padding:6px;border-bottom:1px solid #f3f3f3;text-align:right">${Math.round((r.totalTimeMs||0)/1000)}s</td>
    </tr>`;
  });
  html += `</tbody></table>`;
  $("finalTable").innerHTML = html;
}

/* =========================
   åˆæœŸè¡¨ç¤ºï¼šãƒ«ãƒ¼ãƒ ä¸€è¦§è³¼èª­é–‹å§‹
   ========================= */
startRoomListeners();

/* =========================
   åå‰æœªå…¥åŠ› â†’ è­¦å‘ŠéŸ³
   ========================= */
 // ï¼ˆjoinBtn ã§å‡¦ç†æ¸ˆã¿ï¼‰

</script>
</body>
</html>
